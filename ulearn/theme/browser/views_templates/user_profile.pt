<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<head>
    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border',1);
                             disable_column_one python:request.set('disable_plone.leftcolumn',1);
                             disable_column_two python:request.set('disable_plone.rightcolumn',1);" />
</head>

<body>

<tal:comment replace="nothing">
    Please note that this template fills the "content" slot instead of the
    "main" slot, this is done so we can provide stuff like the content
    tabs. This also means that we have to supply things that are normally
    present from main_template.
</tal:comment>

<metal:main fill-slot="content">
    <tal:main-macro metal:define-macro="main"
                    tal:define="username view/username;
                                mtool python:context.portal_membership;
                                portrait python: mtool.getPersonalPortrait(username);
                                portal_types context/portal_types;
                                userinfo python: mtool.getMemberInfo(username);
                                portal_url context/@@plone_portal_state/navigation_root_url;
                                here_url context/@@plone_context_state/object_url;
                                member context/@@plone_portal_state/member;
                                portal context/@@plone_portal_state/portal;
                                email_from_address portal/email_from_address">

        <tal:noAuthor condition="not: userinfo">
            <dl class="portalMessage error">
                <dt i18n:translate="">
                    Error
                </dt>
                <dd i18n:translate="text_no_user_by_name">
                    No user by that name.
                </dd>
            </dl>
            <div id="content">
                &nbsp;
            </div>
        </tal:noAuthor>


        <tal:haveAuthor condition="userinfo"
            tal:define="isOwner python:member.getId()==username;
                        isAnon context/@@plone_portal_state/anonymous;">

            <div id="edit-bar" tal:condition="isOwner">
                <h5 class="hiddenStructure">Views</h5>
                <ul id="content-views"
                    class="contentViews">
                  <li class="selected">
                    <a href=""
                        tal:define="url_quote_plus python:modules['Products.PythonScripts.standard'].url_quote_plus;
                                    memberurl python:url_quote_plus(member.getId())"
                       tal:attributes="href string:${portal_url}/author/${memberurl}"
                       i18n:translate="label_view">View</a>
                  </li>
                  <li>
                    <a href=""
                       tal:attributes="href string:${portal_url}/@@personal-information"
                       i18n:translate="label_edit">Edit</a>
                  </li>
                </ul>
                <div class="contentActions">&nbsp;</div>
                 <!-- end simulated tabs -->
            </div>


            <div metal:use-macro="context/global_statusmessage/macros/portal_message">
                Portal status message
            </div>

            <div id="content">
                <!-- Author information -->
                <h1 class="documentFirstHeading" tal:condition="userinfo/fullname" tal:content="userinfo/fullname">
                    Author name
                </h1>

                <h1 class="documentFirstHeading" tal:condition="not: userinfo/fullname" tal:content="username">
                    Author ID
                </h1>

                <div class="documentDescription" tal:content="userinfo/description">
                    Author description.
                </div>

                <div id="content-core">
                    <div class="discreet">
                        <tal:location condition="userinfo/location"
                                      i18n:translate="text_location">
                            Location:
                            <span tal:content="userinfo/location"
                                  tal:omit-tag=""
                                  i18n:name="location">
                                Some location
                            </span>
                        </tal:location>

                        <tal:language condition="userinfo/language">
                        &mdash;
                        <span i18n:translate="label_main_language">Main Language:</span>
                        <span tal:replace="userinfo/language">Some language</span>
                        </tal:language>
                    </div>

                    <img src=""
                         alt=""
                         class="portraitPhoto"
                         width="75"
                         style="float: left; margin: 1em;"
                         tal:attributes="src portrait/absolute_url" />

                    <div class="visualClear"><!-- --></div>

                    <p tal:condition="python:mtool.getHomeFolder(id=username)">
                    <a href="#" tal:attributes="href python:mtool.getHomeFolder(id=username).absolute_url()"
                       i18n:translate="label_author_internal_home_page">Author's home page in this site&hellip;</a>
                    </p>

                    <p tal:condition="python: not mtool.getHomeFolder(id=username) and userinfo['home_page']">
                    <a href="#"
                       rel="nofollow"
                       tal:attributes="href userinfo/home_page"
                       i18n:translate="label_author_external_home_page">Author's external home page&hellip;</a>
                    </p>

                    <tal:noemailsetup tal:condition="python:not (email_from_address or isAnon)">
                        <p class="discreet"
                           i18n:translate="text_no_email_setup">
                            This site doesn't have a valid email setup, so you cannot use
                            any contact forms.
                        </p>
                    </tal:noemailsetup>

                    <tal:noemail tal:condition="python:not isAnon and not member.getProperty('email')">
                        <p class="discreet"
                           i18n:translate="text_no_member_email">
                            You do not have an email address, so you
                            cannot use any contact forms. Please edit
                            your personal information.
                        </p>
                    </tal:noemail>

                    <!-- listing of content created by this user -->
                    <tal:authorContent define="author_content python:context.portal_catalog.searchResults(dict(Creator=username, sort_on='created', sort_order='reverse'))[:10];"
                                       condition="author_content">

                        <h2 i18n:translate="heading_author_content">
                            Latest content created by this user
                        </h2>

                        <div metal:define-macro="user_content_listing">
                        <table class="vertical listing"
                               summary="Lists content written by an author grouped by content type"
                               i18n:attributes="summary summary_author_content_list;">
                            <tal:repeat repeat="item author_content">
                                <tr>
                                    <th tal:define="toLocalizedTime nocall: context/@@plone/toLocalizedTime;"
                                        tal:content="python:toLocalizedTime(item.Date)"
                                        style="white-space: nowrap">
                                        Date
                                    </th>
                                    <td>
                                        <a href="" tal:attributes="href item/getURL"
                                           tal:content="item/pretty_title_or_id">title</a>
                                    </td>
                                </tr>
                            </tal:repeat>
                        </table>
                        </div>

                        <p>
                        <a href=""
                           tal:attributes="href string:$here_url/search?Creator=${username}&amp;sort_on=created&amp;sort_order=reverse"
                           i18n:translate="go_to_search_author_content">
                            All content created by
                            <span i18n:name="user" tal:omit-tag="" tal:content="python:userinfo['fullname'] or username"/>&hellip;
                        </a>
                        </p>

                    </tal:authorContent>
                </div>
            </div>



            </tal:haveAuthor>

    </tal:main-macro>

</metal:main>

</body>
</html>
